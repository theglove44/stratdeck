# stratdeck/config/strategies.yaml

# --- UNIVERSES -------------------------------------------------------------
# Each universe describes:
# - product_type: index / equity / etf / any
# - source: where tickers come from (static, local_file, tasty_watchlist)

universes:
  index_core:
    description: "Core index underlyings for SPX/XSP style strategies"
    product_type: index
    source:
      type: static
      tickers: [SPX, NVDA, AAPL, GOOGL, AMZN]

  tasty_watchlist_chris_historical_trades:
    product_type: any
    source:
      type: tasty_watchlist
      watchlist_name: "Chris Historical Trades"

  earnings_plays:
    description: "Short-term earnings strategies from a local watchlist file"
    product_type: equity
    source:
      type: local_file
      path: "stratdeck/config/earnings_watchlist.yaml"  # relative to repo root


# --- STRATEGY TEMPLATES ----------------------------------------------------
# Each strategy template:
# - name: internal id
# - label: human-readable
# - applies_to_universes: which universes to run this on
# - product_type: index / equity / etf / any
# - order_side: buy/sell (almost always sell)
# - option_type: put/call/both
# - dte: target / min / max
# - delta: rules for short leg deltas
# - width_rule: how wide spreads should be (derived from price or allowed widths)
# - filters: POP, credit/width, IVR, etc.

strategies:
  - name: short_put_spread_index_45d
    label: "Index Short Put Spread ~45 DTE"
    enabled: true
    applies_to_universes: [index_core, tasty_watchlist_chris_historical_trades]
    product_type: index
    order_side: sell
    option_type: put

    dte:
      target: 45
      min: 40
      max: 50

    expiry_rules:
      monthlies_only: true

    delta:
      short_leg:
        target: 0.30
        min: 0.25
        max: 0.35

    width_rule:
      type: fixed
      allowed: [5]
      default: 5

    filters:
      min_pop: 0.60
      min_credit_per_width: 0.25
      min_ivr: 0.25
    allowed_trend_regimes: ["uptrend", "range", "chop", "choppy_trend"]
    blocked_trend_regimes: ["downtrend"]
    allowed_vol_regimes: ["normal", "high", "expansion", "low", "extreme"]

    risk_limits:
      max_buying_power: 500
      max_positions_per_symbol: 1

    exit_rules:
      profit_target_fraction: 0.5
      dte_exit_target: 21
      dte_exit_flex: 5
      respect_earnings: true

  - name: short_put_spread_equity_45d
    label: "Equity Short Put Spread ~45 DTE"
    enabled: true
    applies_to_universes: [tasty_watchlist_chris_historical_trades]
    product_type: equity
    order_side: sell
    option_type: put

    dte:
      target: 45
      min: 40
      max: 50

    expiry_rules:
      monthlies_only: true
      earnings_buffer_days: 21

    delta:
      short_leg:
        target: 0.30
        min: 0.25
        max: 0.35

    width_rule:
      type: fixed
      allowed: [5]
      default: 5

    filters:
      min_pop: 0.60
      min_credit_per_width: 0.25
      min_ivr: 0.25
      max_ivr: 0.90
    allowed_trend_regimes: ["uptrend", "range", "chop", "choppy_trend"]
    blocked_trend_regimes: ["downtrend"]

    risk_limits:
      max_buying_power: 500
      max_positions_per_symbol: 1

    exit_rules:
      profit_target_fraction: 0.5
      dte_exit_target: 21
      dte_exit_flex: 5
      respect_earnings: true


  - name: iron_condor_index_45d
    label: "Index Iron Condor ~45 DTE"
    enabled: true
    applies_to_universes: [tasty_watchlist_chris_historical_trades, index_core]
    product_type: index
    order_side: sell
    option_type: both   # short call spread + short put spread

    dte:
      target: 45
      min: 40
      max: 50

    expiry_rules:
      monthlies_only: true

    # For ICs we still care about short-leg delta band; width determines wings.
    delta:
      short_leg:
        target: 0.30
        min: 0.25
        max: 0.35

    width_rule:
      type: fixed
      allowed: [5]
      default: 5

    filters:
      min_pop: 0.60
      min_credit_per_width: 0.25
      min_ivr: 0.30
      max_ivr: 1.00
    allowed_trend_regimes: ["range", "chop"]
    blocked_trend_regimes: ["uptrend", "downtrend"]

    risk_limits:
      max_buying_power: 500
      max_positions_per_symbol: 1
      max_position_delta: 2.0

    exit_rules:
      profit_target_fraction: 0.5
      dte_exit_target: 21
      dte_exit_flex: 5
      respect_earnings: true
